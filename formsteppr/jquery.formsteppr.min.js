// FormSteppr 0.5 / by Johannes Holmberg (jholmberg.com) / MIT License
(function(a){a.fn.extend({formSteppr:function(b){var c={wrapperClass:"formsteppr",prevButton:true,prevButtonText:"Back",nextButtonText:"Next step",errorMessage:"This field cannot be empty.",errorMessageEmail:"This looks like an invalid email address.",errorMessagePhone:"This looks like an invalid phone number.",requiredFieldText:"Field is required."};var b=a.extend(c,b);return this.each(function(){function s(b){for(var d=0;d<b.length;d++){var e=c.errorMessage;if(b[d][1]=="email"){e=c.errorMessageEmail}else if(b[d][1]=="phone"){e=c.errorMessagePhone}var f=a('<div class="fs-error-message">'+e+"</div>");a(b[d][0]).parent().append(f);a(b[d][0]).addClass("fs-invalid")}a(b[0]).focus()}function r(b){var c=new Array;for(var d=0;d<b.length;d++){var e=a(b[d]).attr("required");if(typeof e!=="undefined"&&e!==false){if(a(b[d]).is("[type=email]")){var f=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!f.test(a(b[d]).val())){c.push([a(b[d]),"email"])}}else if(a(b[d]).is("[type=tel]")){var f=/^(\+)?[0-9 -]*[0-9]$/;if(!f.test(a(b[d]).val())){c.push([a(b[d]),"phone"])}}else{if(a(b[d]).val().length===0){c.push(a(b[d]))}}}}return c}var c=b;var d=a(this);d.wrap('<div class="'+c.wrapperClass+'"></div>');d.find("fieldset:gt(0)").addClass("s-hidden");d.find("legend").addClass("s-hidden");a("fieldset").first().addClass("s-display");a('<nav class="fs-progress"></nav>').insertBefore(d);d.parent().find(".fs-progress").append("<ul></ul>");var e=a("fieldset").last();d.find('[type="submit"]').addClass("fs-submit-button").appendTo(e);var f=d.find("fieldset").length;var g=new Array;for(var h=1;h<f;h++){g.push(a("<button />").text(c.nextButtonText).attr("id","next-step-"+h).attr("class","button proceed"))}if(c.prevButton){var i=new Array;for(var h=1;h<f;h++){i.push(a("<button />").text(c.prevButtonText).attr("id","prev-step-"+h).attr("class","button back"))}}a("input, textarea").each(function(){var b=a('<div class="fs-input-wrap" />');a(b).appendTo(a(this).parents("fieldset"));var d=a(this).attr("id");a(this).parent().find('label[for="'+d+'"]').appendTo(b);a(this).appendTo(b);var e=a(this).attr("required");if(typeof e!=="undefined"&&e!==false){a(this).siblings("label").append('<span class="fs-field-required">*</span>');var f=a(this).attr("placeholder");if(f!==undefined){f+=" *";a(this).attr("placeholder",f)}a(this).parents("fieldset").find(".fs-required-text").remove();a(this).parents("fieldset").prepend('<div class="fs-required-text">* '+c.requiredFieldText+"</div>")}});a(this).find("input").first().focus();a("input, textarea").blur(function(){var b=a(this).attr("required");if(typeof b!=="undefined"&&b!==false){a(this).removeClass();if(a(this).is("[type=email]")){var c=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!c.test(a(this).val())){a(this).addClass("fs-invalid")}else{a(this).addClass("fs-valid").parent().find(".fs-error-message").removeClass().addClass("s-hidden")}}else if(a(this).is("[type=tel]")){var c=/^(\+)?[0-9 -]*[0-9]$/;if(!c.test(a(this).val())){a(this).addClass("fs-invalid")}else{a(this).addClass("fs-valid").parent().find(".fs-error-message").removeClass().addClass("s-hidden")}}else{if(a(this).val().length===0){a(this).addClass("fs-invalid")}else{a(this).addClass("fs-valid").parent().find(".fs-error-message").removeClass().addClass("s-hidden")}}}});var j;for(var h=0;h<g.length+1;h++){var k=h+1;var l=a("fieldset:eq("+h+")");var m=a('<div class="fs-buttons"></div>');m.append(g[h]);if(c.prevButton&&k!=1){m.append(i[h])}l.attr("id","step-"+k).append(m);var n=l.find("legend:eq(0)").text();var o=a("<a></a>").attr("href","#").text(n).attr("class","step-"+k);var p=a("<li></li>");a(p).append(o);d.parent().find(".fs-progress ul").append(p);a("#next-step-"+h).click(function(){a(".fs-error-message").removeClass("s-display").addClass("s-hidden");var b=r(a(this).parent().parent().find("input, textarea"));if(b.length==0){d.parent().find(".fs-progress").find(".active").removeClass("active").addClass("through").parent().next().find("a").addClass("active");a(this).parent().parent().fadeOut(200,function(){a(this).removeClass("s-display").addClass("s-hidden");a(this).next().fadeIn(200,function(){a(this).removeClass("s-hidden").addClass("s-display");j=a(this);a(this).find("input, textarea, select").first().focus()})})}else{s(b)}return false});a("#prev-step-"+h).click(function(){d.parent().find(".fs-progress").find(".active").removeClass("active").parent().prev().find("a").addClass("active");a(this).parent().parent().fadeOut(200,function(){a(this).removeClass("s-display").addClass("s-hidden");a(this).prev().fadeIn(200,function(){a(this).removeClass("s-hidden").addClass("s-display");j=a(this);a(this).find("input, textarea, select").first().focus()})});return false});var q=h+1;a(".step-"+q).click(function(){if(a(this).hasClass("through")){var b=a(this).attr("class").split(" ")[0];var c=b.split("-")[1];var e=j.attr("id").split("-")[1];a(".fs-error-message").removeClass("s-display").addClass("s-hidden");var f=r(j.find("input, textarea"));if(f.length==0){a(".step-"+e).addClass("through");var g=b.split("-")[1]-1;d.parent().find(".fs-progress").find("a").removeClass("active");a(this).addClass("active");d.find("fieldset").hide();a("#"+b).show();j=d.find("#"+b)}else{s(f);return false}}return false})}d.parent().find(".fs-progress").find("a:eq(0)").addClass("active");d.submit(function(){a(".fs-error-message").removeClass("s-display").addClass("s-hidden");var b=r(a("input, textarea"));if(b.length>0){s(b);return false}})})}})})(jQuery)